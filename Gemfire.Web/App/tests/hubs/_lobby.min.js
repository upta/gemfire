define(["require","exports","tests/helper","hubs/lobby"],function(n,t,i,r){var f=i,u=r;QUnit.module("hubs/lobby",{teardown:function(){f.restore($.connection.hub.start),f.restore($.connection.lobby.server.initializeClient),f.restore(n("durandal/app").trigger),f.restore($.connection.lobby.server.createGame),f.restore($.connection.lobby.server.joinGame),f.restore($.connection.lobby.server.leaveGame),f.restore($.connection.lobby.server.getGames)}}),asyncTest("start() -> Starts hub connection",1,function(){sinon.stub($.connection.hub,"start",function(){ok(!0),start()}),u.start("reg-id")}),asyncTest("start() -> Requests client initialization upon connecting",1,function(){sinon.stub($.connection.hub,"start",function(n){n()}),sinon.stub($.connection.lobby.server,"initializeClient",function(){return ok(!0),start(),$.Deferred().promise()}),u.start("reg-id")}),asyncTest("start() -> Resolves if initialized",1,function(){sinon.stub($.connection.hub,"start",function(n){n()}),sinon.stub($.connection.lobby.server,"initializeClient",function(){return $.Deferred(function(n){n.resolve({})}).promise()}),u.start("reg-id").fail(function(){ok(!1,"Shouldn't have failed with an init object")}).done(function(){ok(!0)}).always(function(){start()})}),asyncTest("start() -> Rejects if failed to initialize",1,function(){sinon.stub($.connection.hub,"start",function(n){n()}),sinon.stub($.connection.lobby.server,"initializeClient",function(){return $.Deferred(function(n){n.resolve(null)}).promise()}),u.start("reg-id").fail(function(){ok(!0)}).done(function(){ok(!1,"Shouldn't have resolved without an init object")}).always(function(){start()})}),test("Wires $.connection.lobby.client.gameCreated to publish Triggers.gameCreated",function(){sinon.stub(n("durandal/app"),"trigger",function(n){ok(n===u.Triggers.gameCreated)}),$.connection.lobby.client.gameCreated(null)}),test("Wires $.connection.lobby.client.gameRemoved to publish Triggers.gameRemoved",function(){sinon.stub(n("durandal/app"),"trigger",function(n){ok(n===u.Triggers.gameRemoved)}),$.connection.lobby.client.gameRemoved(null)}),test("Wires $.connection.lobby.client.joinedGame to publish Triggers.joinedGame",function(){sinon.stub(n("durandal/app"),"trigger",function(n){ok(n===u.Triggers.joinedGame)}),$.connection.lobby.client.joinedGame(null,null)}),test("Wires $.connection.lobby.client.leftGame to publish Triggers.leftGame",function(){sinon.stub(n("durandal/app"),"trigger",function(n){ok(n===u.Triggers.leftGame)}),$.connection.lobby.client.leftGame(null,null)}),test("createGame() => Calls createGame on hub",function(){sinon.stub($.connection.lobby.server,"createGame",function(){ok(!0)}),u.createGame(null,null)}),test("joinGame() => Calls joinGame on hub",function(){sinon.stub($.connection.lobby.server,"joinGame",function(){ok(!0)}),u.joinGame(null)}),test("leaveGame() => Calls leaveGame on hub",function(){sinon.stub($.connection.lobby.server,"leaveGame",function(){ok(!0)}),u.leaveGame(null)}),test("getGames() => Calls getGames on hub",function(){sinon.stub($.connection.lobby.server,"getGames",function(){ok(!0)}),u.getGames()})})